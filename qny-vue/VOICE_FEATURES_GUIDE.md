# 🎤 前端语音功能使用指南

## 📋 功能概览

### **已实现的语音功能**
- ✅ **STT (语音转文字)** - 用户语音输入
- ✅ **TTS (文字转语音)** - AI回复语音播放
- ✅ **自动播放** - AI回复后自动播放语音
- ✅ **手动播放** - 点击消息播放按钮重播
- ✅ **播放控制** - 停止播放功能
- ✅ **音频队列** - 支持多个音频排队播放

## 🎯 功能详解

### **1. 语音输入 (STT)**
- **触发方式**: 点击麦克风按钮
- **支持浏览器**: Chrome, Edge, Safari (需要HTTPS)
- **语言**: 中文 (zh-CN)
- **状态指示**: 麦克风按钮高亮 + 语音识别弹窗

### **2. 语音播放 (TTS)**
- **自动播放**: AI回复后自动播放语音
- **手动播放**: 点击消息右下角的播放按钮
- **播放控制**: 输入栏显示停止按钮
- **音频格式**: MP3
- **发音人**: 龙小春 (longxiaochun)

### **3. 播放控制**
- **播放状态**: 实时显示播放状态
- **停止功能**: 可随时停止当前播放
- **队列管理**: 多个音频自动排队播放
- **资源清理**: 组件卸载时自动清理音频资源

## 🎨 界面元素

### **输入栏按钮**
```
[输入框] [发送] [🎤麦克风] [⏸️停止]
```

### **消息播放按钮**
```
AI消息内容
[▶️播放按钮]
```

### **状态指示**
- **麦克风按钮**: 蓝色高亮 = 正在录音
- **播放按钮**: 播放/暂停图标切换
- **停止按钮**: 播放时显示红色停止按钮

## 🔧 技术实现

### **API接口**
```javascript
// STT - 语音转文字
speechToTextAPI(audioFile)

// TTS - 文字转语音  
textToSpeechAPI({
  content: text,
  voice: "longxiaochun",
  format: "mp3"
})
```

### **音频处理**
```javascript
// Base64转音频
const audioData = atob(response.audio_base64);
const audioBlob = new Blob([new Uint8Array(audioData)], { type: 'audio/mp3' });
const audioUrl = URL.createObjectURL(audioBlob);
```

### **播放队列**
```javascript
// 音频队列管理
audioQueue.value.push(audio);
if (!isPlaying.value) {
  playNextAudio();
}
```

## 🚀 使用流程

### **完整语音对话流程**
1. **用户点击麦克风** → 开始语音识别
2. **用户说话** → 语音转文字
3. **文字显示在输入框** → 用户确认或修改
4. **用户点击发送** → 发送消息给AI
5. **AI回复** → 显示文字 + 自动播放语音
6. **用户可重播** → 点击播放按钮

### **手动播放流程**
1. **AI回复显示** → 消息右下角出现播放按钮
2. **用户点击播放** → 重新播放该消息的语音
3. **播放控制** → 可随时停止播放

## ⚙️ 配置选项

### **发音人选择**
```javascript
// 支持的发音人
const voices = {
  "longxiaochun": "龙小春",           // 温暖女声
  "longxiaochun_emotional": "龙小春情感", // 情感女声  
  "longfei": "龙飞",                 // 成熟男声
  "longxiaowen": "龙小雯",           // 温柔女声
  "longjing": "龙静"                 // 知性女声
};
```

### **音频格式**
- **格式**: MP3
- **采样率**: 16kHz
- **声道**: 单声道

## 🔍 故障排除

### **常见问题**

1. **语音识别不工作**
   - 检查浏览器是否支持Web Speech API
   - 确认页面使用HTTPS协议
   - 检查麦克风权限

2. **语音播放失败**
   - 检查网络连接
   - 确认后端TTS服务正常
   - 检查浏览器音频权限

3. **音频播放卡顿**
   - 检查网络速度
   - 清除浏览器缓存
   - 检查设备性能

### **调试方法**
```javascript
// 检查语音识别支持
console.log('SpeechRecognition支持:', !!window.SpeechRecognition);

// 检查音频播放支持
console.log('Audio支持:', !!window.Audio);

// 检查TTS API响应
console.log('TTS响应:', response);
```

## 🎉 功能特点

- ✅ **无缝集成** - 与现有聊天界面完美融合
- ✅ **自动播放** - AI回复后自动播放语音
- ✅ **手动控制** - 支持手动播放和停止
- ✅ **队列管理** - 多个音频自动排队播放
- ✅ **资源管理** - 自动清理音频资源
- ✅ **状态反馈** - 实时显示播放状态
- ✅ **错误处理** - 完善的异常处理机制

## 🔮 未来扩展

- **语音选择** - 支持不同发音人选择
- **播放速度** - 支持播放速度调节
- **音量控制** - 支持音量调节
- **语音设置** - 语音功能设置页面
- **离线支持** - 支持离线语音功能

现在前端聊天页面已完全支持语音功能！🎤
