# AI è§’è‰²æ‰®æ¼”ç³»ç»Ÿ - ç¨‹åºè¿è¡Œè¯´æ˜

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

### åŸºç¡€ç¯å¢ƒ
- **Python**: 3.11+ 
- **Node.js**: 18+ æˆ– 20+
- **MySQL**: 5.7+ æˆ– 8.0+
- **Redis**: 6.0+

### å¤–éƒ¨æœåŠ¡
- **é€šä¹‰åƒé—®**: å¤§è¯­è¨€æ¨¡å‹æœåŠ¡
- **ç™¾åº¦è¯­éŸ³**: è¯­éŸ³è¯†åˆ«å’ŒåˆæˆæœåŠ¡
- **é˜¿é‡Œäº‘OSS**: æ–‡ä»¶å­˜å‚¨æœåŠ¡

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. åç«¯å¯åŠ¨

#### ç¯å¢ƒå‡†å¤‡
```bash
# è¿›å…¥åç«¯ç›®å½•
cd ai-roleplay-demo/ai-roleplay-demo/backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

#### ç¯å¢ƒé…ç½®
```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å…³é”®å‚æ•°ï¼š
```

**å¿…éœ€é…ç½®é¡¹**ï¼š
```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=mysql+pymysql://username:password@localhost:3306/ai_roleplay?charset=utf8mb4

# Redisé…ç½®
REDIS_URL=redis://localhost:6379/0

# JWTå¯†é’¥
SECRET_KEY=your-secret-key-here

# é€šä¹‰åƒé—®API
DASHSCOPE_API_KEY=your-dashscope-api-key

# ç™¾åº¦è¯­éŸ³æœåŠ¡
BAIDU_APP_ID=your-baidu-app-id
BAIDU_API_KEY=your-baidu-api-key
BAIDU_SECRET_KEY=your-baidu-secret-key

# é˜¿é‡Œäº‘OSSï¼ˆå¯é€‰ï¼‰
OSS_ACCESS_KEY_ID=your-oss-access-key-id
OSS_ACCESS_KEY_SECRET=your-oss-access-key-secret
OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com
OSS_BUCKET_NAME=your-bucket-name
```

#### æ•°æ®åº“åˆå§‹åŒ–
```bash
# åˆ›å»ºæ•°æ®åº“è¡¨
python init_db.py

# è¿è¡Œæ•°æ®è¿ç§»ï¼ˆå¦‚æœæœ‰ï¼‰
python migrate_new_features.py
```

#### å¯åŠ¨åç«¯æœåŠ¡
```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
uvicorn main:app --reload --port 8000

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨ï¼ˆæ¨èä½¿ç”¨Gunicornï¼‰
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

### 2. å‰ç«¯å¯åŠ¨

#### ç¯å¢ƒå‡†å¤‡
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd ai-roleplay-demo/ai-roleplay-demo/frontend

# å®‰è£…ä¾èµ–
npm install
```

#### é…ç½®APIåœ°å€
ç¼–è¾‘ `src/api/api.js` æ–‡ä»¶ï¼Œä¿®æ”¹åç«¯APIåœ°å€ï¼š
```javascript
// å¼€å‘ç¯å¢ƒ
const baseURL = "http://localhost:8000";

// ç”Ÿäº§ç¯å¢ƒ
// const baseURL = "http://your-server-ip:8000";
```

#### å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

### 3. è®¿é—®åº”ç”¨

- **å‰ç«¯åœ°å€**: http://localhost:3000
- **åç«¯API**: http://localhost:8000
- **APIæ–‡æ¡£**: http://localhost:8000/docs

## ğŸ”§ è¯¦ç»†é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

#### MySQLé…ç½®
```bash
# åˆ›å»ºæ•°æ®åº“
mysql -u root -p
CREATE DATABASE ai_roleplay CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# åˆ›å»ºç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
CREATE USER 'ai_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON ai_roleplay.* TO 'ai_user'@'localhost';
FLUSH PRIVILEGES;
```

#### Redisé…ç½®
```bash
# å¯åŠ¨RedisæœåŠ¡
redis-server

# æµ‹è¯•è¿æ¥
redis-cli ping
```

### å¤–éƒ¨æœåŠ¡é…ç½®

#### é€šä¹‰åƒé—®API
1. è®¿é—® [é˜¿é‡Œäº‘é€šä¹‰åƒé—®](https://dashscope.aliyun.com/)
2. æ³¨å†Œè´¦å·å¹¶è·å–API Key
3. åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½® `DASHSCOPE_API_KEY`

#### ç™¾åº¦è¯­éŸ³æœåŠ¡
1. è®¿é—® [ç™¾åº¦æ™ºèƒ½äº‘](https://cloud.baidu.com/)
2. å¼€é€šè¯­éŸ³æŠ€æœ¯æœåŠ¡
3. åˆ›å»ºåº”ç”¨è·å– App IDã€API Keyã€Secret Key
4. åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ç›¸å…³å‚æ•°

#### é˜¿é‡Œäº‘OSSï¼ˆå¯é€‰ï¼‰
1. è®¿é—® [é˜¿é‡Œäº‘OSS](https://oss.console.aliyun.com/)
2. åˆ›å»ºBucket
3. è·å–AccessKey IDå’ŒAccessKey Secret
4. åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ç›¸å…³å‚æ•°

## ğŸ³ Dockeréƒ¨ç½²

### åç«¯Dockeréƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
cd ai-roleplay-demo/ai-roleplay-demo/backend
docker build -t ai-roleplay-backend .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 --env-file .env ai-roleplay-backend
```

### ä½¿ç”¨Docker Compose
```yaml
# docker-compose.yml
version: '3.8'
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=mysql+pymysql://root:password@mysql:3306/ai_roleplay
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - mysql
      - redis

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: ai_roleplay
    volumes:
      - mysql_data:/var/lib/mysql

  redis:
    image: redis:6.0-alpine

volumes:
  mysql_data:
```

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d
```

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+ / CentOS 7+)
- **å†…å­˜**: æœ€å°‘2GBï¼Œæ¨è4GB+
- **å­˜å‚¨**: æœ€å°‘20GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„ç½‘ç»œè¿æ¥

### éƒ¨ç½²æ­¥éª¤

#### 1. æœåŠ¡å™¨å‡†å¤‡
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…è¦è½¯ä»¶
sudo apt install python3.11 python3.11-venv python3.11-dev
sudo apt install mysql-server redis-server
sudo apt install nginx git
```

#### 2. ä»£ç éƒ¨ç½²
```bash
# å…‹éš†ä»£ç 
git clone <your-repo-url>
cd ai-roleplay-demo/ai-roleplay-demo

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r backend/requirements.txt
```

#### 3. é…ç½®æœåŠ¡
```bash
# é…ç½®MySQL
sudo mysql_secure_installation

# å¯åŠ¨Redis
sudo systemctl start redis-server
sudo systemctl enable redis-server

# é…ç½®Nginx
sudo vim /etc/nginx/sites-available/ai-roleplay
```

**Nginxé…ç½®ç¤ºä¾‹**ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### 4. ç³»ç»ŸæœåŠ¡é…ç½®
```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo vim /etc/systemd/system/ai-roleplay.service
```

**æœåŠ¡é…ç½®**ï¼š
```ini
[Unit]
Description=AI Roleplay Backend
After=network.target

[Service]
Type=exec
User=www-data
Group=www-data
WorkingDirectory=/path/to/ai-roleplay-demo/ai-roleplay-demo/backend
Environment=PATH=/path/to/venv/bin
ExecStart=/path/to/venv/bin/python -m uvicorn main:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
# å¯ç”¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable ai-roleplay
sudo systemctl start ai-roleplay
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
sudo systemctl status mysql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u username -p -h localhost database_name

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw allow 3306
```

#### 2. Redisè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
sudo systemctl status redis-server

# æµ‹è¯•Redisè¿æ¥
redis-cli ping

# æ£€æŸ¥Redisé…ç½®
sudo vim /etc/redis/redis.conf
```

#### 3. APIè°ƒç”¨å¤±è´¥
```bash
# æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
curl http://localhost:8000/health

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u ai-roleplay -f

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :8000
```

#### 4. å‰ç«¯æ„å»ºå¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜
npm cache clean --force

# åˆ é™¤node_modulesé‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install

# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version
```

### æ—¥å¿—æŸ¥çœ‹

#### åç«¯æ—¥å¿—
```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u ai-roleplay -f

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

#### åº”ç”¨æ—¥å¿—
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—æ–‡ä»¶
tail -f /path/to/logs/app.log
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_user_id ON chat_messages(user_id);
CREATE INDEX idx_conversation_id ON chat_messages(conversation_id);
CREATE INDEX idx_created_at ON chat_messages(created_at);

-- ä¼˜åŒ–æŸ¥è¯¢
EXPLAIN SELECT * FROM chat_messages WHERE user_id = ? ORDER BY created_at DESC LIMIT 10;
```

### Redisä¼˜åŒ–
```bash
# é…ç½®Rediså†…å­˜ç­–ç•¥
maxmemory 1gb
maxmemory-policy allkeys-lru

# å¯ç”¨æŒä¹…åŒ–
save 900 1
save 300 10
save 60 10000
```

### åº”ç”¨ä¼˜åŒ–
```python
# ä½¿ç”¨è¿æ¥æ± 
from sqlalchemy.pool import QueuePool

engine = create_engine(
    DATABASE_URL,
    poolclass=QueuePool,
    pool_size=20,
    max_overflow=30,
    pool_pre_ping=True
)
```

## ğŸ”’ å®‰å…¨é…ç½®

### é˜²ç«å¢™é…ç½®
```bash
# é…ç½®UFWé˜²ç«å¢™
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
sudo ufw enable
```

### SSLè¯ä¹¦é…ç½®
```bash
# ä½¿ç”¨Let's Encrypt
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

### æ•°æ®åº“å®‰å…¨
```sql
-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·
CREATE USER 'ai_app'@'localhost' IDENTIFIED BY 'strong_password';
GRANT SELECT, INSERT, UPDATE, DELETE ON ai_roleplay.* TO 'ai_app'@'localhost';
FLUSH PRIVILEGES;
```

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### ç³»ç»Ÿç›‘æ§
```bash
# å®‰è£…ç›‘æ§å·¥å…·
sudo apt install htop iotop nethogs

# ç›‘æ§ç³»ç»Ÿèµ„æº
htop           # CPUå’Œå†…å­˜
iotop          # ç£ç›˜I/O
nethogs        # ç½‘ç»œä½¿ç”¨
```

### åº”ç”¨ç›‘æ§
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status ai-roleplay

# æŸ¥çœ‹æœåŠ¡èµ„æºä½¿ç”¨
sudo systemctl show ai-roleplay --property=MemoryCurrent,CPUUsageNSec
```

### å®šæœŸç»´æŠ¤
```bash
# æ•°æ®åº“å¤‡ä»½
mysqldump -u username -p ai_roleplay > backup_$(date +%Y%m%d).sql

# æ—¥å¿—è½®è½¬
sudo logrotate -f /etc/logrotate.conf

# ç³»ç»Ÿæ›´æ–°
sudo apt update && sudo apt upgrade -y
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨è¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
2. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶
3. ç¡®è®¤æ‰€æœ‰é…ç½®é¡¹æ˜¯å¦æ­£ç¡®è®¾ç½®
4. éªŒè¯ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®
5. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å¼ºå¯†ç ï¼Œå®šæœŸæ›´æ–°ä¾èµ–åŒ…ï¼Œå¹¶ä¿æŒç³»ç»Ÿå®‰å…¨æ›´æ–°ã€‚
